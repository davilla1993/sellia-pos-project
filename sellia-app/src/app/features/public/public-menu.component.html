<div class="menu-container">
  <!-- Header -->
  <header class="menu-header">
    <div class="header-content">
      <div class="header-top">
        <div class="logo-section">
          <img src="assets/logo.jpg" alt="MAISON RECLA" class="logo">
          <h1>MAISON RECLA</h1>
        </div>
        <div class="table-info">
          <span class="table-label">Table {{ tableNumber }}</span>
          <span *ngIf="isVip" class="vip-badge">VIP</span>
        </div>
      </div>

      <!-- Barre de recherche -->
      <div class="search-bar">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (keyup)="filterItems()"
          placeholder="Rechercher un plat..."
          class="search-input">
      </div>
    </div>
  </header>

  <!-- Category Filters -->
  <div *ngIf="!loading && categories.length > 0" class="category-filters">
    <div class="category-filters-container">
      <button
        *ngFor="let category of categories"
        (click)="selectCategory(category.id)"
        [class.active]="selectedCategory === category.id"
        class="category-btn">
        {{ category.name }} <span class="category-count">({{ category.count }})</span>
      </button>
    </div>
  </div>

  <!-- Alerts & Loading -->
  <div *ngIf="error" class="alert alert-error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement du menu...</p>
  </div>

  <div *ngIf="orderSuccess" class="alert alert-success">
    <p>‚úì Commande confirm√©e!</p>
    <p>Num√©ro: <strong>{{ orderNumber }}</strong></p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && !orderSuccess" class="main-content">
    <div class="menu-grid">
      <!-- Items affich√©s -->
      <div *ngFor="let item of filteredItems" class="product-card">
        <div class="product-image-container" *ngIf="item.imagePath">
          <img [src]="item.imagePath" [alt]="item.itemName" class="product-image">
          <span *ngIf="item.isSpecial" class="special-badge">‚≠ê Sp√©cialit√©</span>
          <!-- Badge combo cliquable -->
          <button
            *ngIf="item.productCount && item.productCount > 1"
            class="combo-badge"
            (click)="openComboModal(item)"
            title="Voir les d√©tails du combo">
            üì¶ {{ item.productCount }} produits
          </button>
        </div>
        <div class="product-body">
          <h3 class="product-name">{{ item.itemName }}</h3>
          <p class="product-description">{{ item.description }}</p>
          <p *ngIf="item.specialDescription" class="product-special">{{ item.specialDescription }}</p>
          <div class="product-footer">
            <span class="product-price">{{ formatPrice(item.price) }}</span>
            <button class="btn-add-to-cart" (click)="addToCart(item)">+ Ajouter</button>
          </div>
        </div>
      </div>

      <!-- Aucun r√©sultat -->
      <div *ngIf="filteredItems.length === 0" class="no-results">
        <p>Aucun article ne correspond √† votre recherche</p>
      </div>
    </div>

  </div>

  <!-- Floating Cart Button -->
  <button class="cart-floating-btn" *ngIf="cart.length > 0" (click)="openCart()">
    üõí <span class="cart-count">{{ cart.length }}</span>
    {{ formatPrice(cartTotal) }}
  </button>

  <!-- Cart Modal -->
  <div class="cart-modal" *ngIf="showCart" [class.open]="showCart">
    <div class="cart-modal-overlay" (click)="closeCart()"></div>
    <div class="cart-modal-content">
      <div class="cart-modal-header">
        <h2>Panier</h2>
        <button class="btn-close-modal" (click)="closeCart()">‚úï</button>
      </div>

      <!-- Panier vide -->
      <div *ngIf="cart.length === 0" class="empty-cart">
        <p>Votre panier est vide</p>
      </div>

      <!-- Panier rempli -->
      <div *ngIf="cart.length > 0" class="cart-modal-body">
        <div class="cart-items-list">
          <div *ngFor="let item of cart; let i = index" class="cart-item">
            <div class="item-info">
              <span class="item-name">{{ item.itemName }}</span>
              <span class="item-price">{{ formatPrice(item.unitPrice) }}</span>
            </div>
            <div class="item-actions">
              <button class="qty-btn" (click)="decreaseQuantity(item)">‚àí</button>
              <span class="qty">{{ item.quantity }}</span>
              <button class="qty-btn" (click)="increaseQuantity(item)">+</button>
              <span class="item-total">{{ formatPrice(item.totalPrice) }}</span>
              <button class="btn-delete" (click)="removeFromCart(i)">üóë</button>
            </div>
          </div>
        </div>

        <div class="cart-summary">
          <div class="summary-row">
            <span>Sous-total</span>
            <strong>{{ formatPrice(cartTotal) }}</strong>
          </div>
        </div>

        <div class="customer-info">
          <h3>Vos informations</h3>
          <input type="text" [(ngModel)]="customerName" placeholder="Nom (optionnel)" class="input-field">
          <input type="tel" [(ngModel)]="customerPhone" placeholder="T√©l. (optionnel)" class="input-field">
          <textarea [(ngModel)]="notes" placeholder="Allergies, pr√©f√©rences..." class="input-field"></textarea>
        </div>

        <button 
          class="btn-submit-order" 
          (click)="submitOrder()"
          [disabled]="submitting">
          {{ submitting ? '‚è≥ Envoi...' : `Commander - ${formatPrice(cartTotal)}` }}
        </button>
      </div>
    </div>
  </div>

  <!-- Combo Details Modal -->
  <div class="combo-modal" *ngIf="showComboModal && selectedCombo" [class.open]="showComboModal">
    <div class="combo-modal-overlay" (click)="closeComboModal()"></div>
    <div class="combo-modal-content">
      <div class="combo-modal-header">
        <h2>{{ selectedCombo.itemName }}</h2>
        <button class="btn-close-modal" (click)="closeComboModal()">‚úï</button>
      </div>

      <div class="combo-modal-body">
        <p class="combo-description">Ce combo contient :</p>

        <div class="combo-products-list">
          <div *ngFor="let product of selectedCombo.comboProducts" class="combo-product-item">
            <div class="combo-product-image">
              <img [src]="product.imageUrl" [alt]="product.name" *ngIf="product.imageUrl">
              <div *ngIf="!product.imageUrl" class="combo-product-no-image">üì¶</div>
            </div>
            <div class="combo-product-info">
              <span class="combo-product-name">{{ product.name }}</span>
              <span class="combo-product-price">{{ formatPrice(product.price) }}</span>
            </div>
          </div>
        </div>

        <div class="combo-total">
          <span>Prix total du combo</span>
          <strong>{{ formatPrice(selectedCombo.price) }}</strong>
        </div>
      </div>
    </div>
  </div>
</div>
