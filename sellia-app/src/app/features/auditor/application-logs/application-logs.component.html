<div class="min-h-screen bg-neutral-50 p-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-neutral-800 mb-2">ðŸ“‹ Logs de l'Application</h1>
    <p class="text-neutral-600">Visualisez et analysez les logs de votre application en temps rÃ©el</p>
  </div>

  <!-- Stats Cards -->
  @if (stats()) {
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <!-- Total Logs -->
      <div class="bg-white rounded-lg shadow p-6 border-l-4 border-neutral-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-neutral-600 mb-1">Total Logs</p>
            <p class="text-3xl font-bold text-neutral-800">{{ stats()!.totalLogs }}</p>
          </div>
          <svg class="w-12 h-12 text-neutral-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
        </div>
      </div>

      <!-- INFO Logs -->
      <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-neutral-600 mb-1">INFO</p>
            <p class="text-3xl font-bold text-blue-600">{{ stats()!.infoCount }}</p>
            <p class="text-xs text-neutral-500">{{ stats()!.infoPercent }}%</p>
          </div>
          <svg class="w-12 h-12 text-blue-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
          </svg>
        </div>
      </div>

      <!-- WARN Logs -->
      <div class="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-neutral-600 mb-1">WARN</p>
            <p class="text-3xl font-bold text-yellow-600">{{ stats()!.warnCount }}</p>
            <p class="text-xs text-neutral-500">{{ stats()!.warnPercent }}%</p>
          </div>
          <svg class="w-12 h-12 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
          </svg>
        </div>
      </div>

      <!-- ERROR Logs -->
      <div class="bg-white rounded-lg shadow p-6 border-l-4 border-red-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-neutral-600 mb-1">ERROR</p>
            <p class="text-3xl font-bold text-red-600">{{ stats()!.errorCount }}</p>
            <p class="text-xs text-neutral-500">{{ stats()!.errorPercent }}%</p>
          </div>
          <svg class="w-12 h-12 text-red-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        </div>
      </div>
    </div>
  }

  <!-- Chart -->
  @if (stats()) {
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <div style="height: 300px;">
        <canvas baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          type="bar">
        </canvas>
      </div>
    </div>
  }

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold text-neutral-800 mb-4">Filtres</h2>

    <!-- Time Range Buttons -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-neutral-700 mb-2">PÃ©riode</label>
      <div class="flex flex-wrap gap-2">
        <button
          (click)="selectTimeRange('1h')"
          [class.bg-blue-600]="selectedTimeRange() === '1h'"
          [class.text-white]="selectedTimeRange() === '1h'"
          [class.bg-neutral-200]="selectedTimeRange() !== '1h'"
          [class.text-neutral-700]="selectedTimeRange() !== '1h'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          1 heure
        </button>
        <button
          (click)="selectTimeRange('3h')"
          [class.bg-blue-600]="selectedTimeRange() === '3h'"
          [class.text-white]="selectedTimeRange() === '3h'"
          [class.bg-neutral-200]="selectedTimeRange() !== '3h'"
          [class.text-neutral-700]="selectedTimeRange() !== '3h'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          3 heures
        </button>
        <button
          (click)="selectTimeRange('6h')"
          [class.bg-blue-600]="selectedTimeRange() === '6h'"
          [class.text-white]="selectedTimeRange() === '6h'"
          [class.bg-neutral-200]="selectedTimeRange() !== '6h'"
          [class.text-neutral-700]="selectedTimeRange() !== '6h'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          6 heures
        </button>
        <button
          (click)="selectTimeRange('12h')"
          [class.bg-blue-600]="selectedTimeRange() === '12h'"
          [class.text-white]="selectedTimeRange() === '12h'"
          [class.bg-neutral-200]="selectedTimeRange() !== '12h'"
          [class.text-neutral-700]="selectedTimeRange() !== '12h'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          12 heures
        </button>
        <button
          (click)="selectTimeRange('1d')"
          [class.bg-blue-600]="selectedTimeRange() === '1d'"
          [class.text-white]="selectedTimeRange() === '1d'"
          [class.bg-neutral-200]="selectedTimeRange() !== '1d'"
          [class.text-neutral-700]="selectedTimeRange() !== '1d'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          1 jour
        </button>
        <button
          (click)="selectTimeRange('1w')"
          [class.bg-blue-600]="selectedTimeRange() === '1w'"
          [class.text-white]="selectedTimeRange() === '1w'"
          [class.bg-neutral-200]="selectedTimeRange() !== '1w'"
          [class.text-neutral-700]="selectedTimeRange() !== '1w'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          1 semaine
        </button>
        <button
          (click)="selectTimeRange('1m')"
          [class.bg-blue-600]="selectedTimeRange() === '1m'"
          [class.text-white]="selectedTimeRange() === '1m'"
          [class.bg-neutral-200]="selectedTimeRange() !== '1m'"
          [class.text-neutral-700]="selectedTimeRange() !== '1m'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          1 mois
        </button>
        <button
          (click)="selectTimeRange('custom')"
          [class.bg-blue-600]="selectedTimeRange() === 'custom'"
          [class.text-white]="selectedTimeRange() === 'custom'"
          [class.bg-neutral-200]="selectedTimeRange() !== 'custom'"
          [class.text-neutral-700]="selectedTimeRange() !== 'custom'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          PersonnalisÃ©
        </button>
      </div>
    </div>

    <!-- Custom Date Range (only visible when custom is selected) -->
    @if (selectedTimeRange() === 'custom') {
      <div class="mb-4 p-4 bg-neutral-50 rounded-lg">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2">Date dÃ©but</label>
            <input
              type="datetime-local"
              [(ngModel)]="customStartDate"
              (change)="customStartDate.set($any($event.target).value)"
              class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2">Date fin</label>
            <input
              type="datetime-local"
              [(ngModel)]="customEndDate"
              (change)="customEndDate.set($any($event.target).value)"
              class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="flex items-end">
            <button
              (click)="applyCustomDateRange()"
              class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              Appliquer
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Level Filter -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-neutral-700 mb-2">Niveau</label>
      <div class="flex flex-wrap gap-2">
        <button
          (click)="changeLevel('ALL')"
          [class.bg-neutral-600]="selectedLevel() === 'ALL'"
          [class.text-white]="selectedLevel() === 'ALL'"
          [class.bg-neutral-200]="selectedLevel() !== 'ALL'"
          [class.text-neutral-700]="selectedLevel() !== 'ALL'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-neutral-500 hover:text-white">
          Tous
        </button>
        <button
          (click)="changeLevel('INFO')"
          [class.bg-blue-600]="selectedLevel() === 'INFO'"
          [class.text-white]="selectedLevel() === 'INFO'"
          [class.bg-blue-200]="selectedLevel() !== 'INFO'"
          [class.text-blue-700]="selectedLevel() !== 'INFO'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-blue-500 hover:text-white">
          INFO
        </button>
        <button
          (click)="changeLevel('WARN')"
          [class.bg-yellow-600]="selectedLevel() === 'WARN'"
          [class.text-white]="selectedLevel() === 'WARN'"
          [class.bg-yellow-200]="selectedLevel() !== 'WARN'"
          [class.text-yellow-700]="selectedLevel() !== 'WARN'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-yellow-500 hover:text-white">
          WARN
        </button>
        <button
          (click)="changeLevel('ERROR')"
          [class.bg-red-600]="selectedLevel() === 'ERROR'"
          [class.text-white]="selectedLevel() === 'ERROR'"
          [class.bg-red-200]="selectedLevel() !== 'ERROR'"
          [class.text-red-700]="selectedLevel() !== 'ERROR'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-red-500 hover:text-white">
          ERROR
        </button>
        <button
          (click)="changeLevel('DEBUG')"
          [class.bg-gray-600]="selectedLevel() === 'DEBUG'"
          [class.text-white]="selectedLevel() === 'DEBUG'"
          [class.bg-gray-200]="selectedLevel() !== 'DEBUG'"
          [class.text-gray-700]="selectedLevel() !== 'DEBUG'"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-gray-500 hover:text-white">
          DEBUG
        </button>
      </div>
    </div>

    <!-- Search -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-neutral-700 mb-2">Recherche</label>
      <div class="flex gap-2">
        <input
          type="text"
          [(ngModel)]="searchText"
          (keyup.enter)="search()"
          (ngModelChange)="searchText.set($event)"
          placeholder="Rechercher dans les messages..."
          class="flex-1 px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <button
          (click)="search()"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Rechercher
        </button>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-4">
        <!-- Auto Refresh Toggle -->
        <label class="flex items-center cursor-pointer">
          <input
            type="checkbox"
            [checked]="autoRefresh()"
            (change)="toggleAutoRefresh()"
            class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
          <span class="ml-2 text-sm font-medium text-neutral-700">
            Auto-refresh (5s)
          </span>
        </label>

        <!-- Logs Count -->
        <span class="text-sm text-neutral-600">
          {{ filteredLogsCount() }} log(s)
        </span>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2">
        <button
          (click)="exportToPDF()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
          ðŸ“„ Exporter en PDF
        </button>
        <button
          (click)="clearAllLogs()"
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
          Vider tous les logs
        </button>
      </div>
    </div>
  </div>

  <!-- Logs List -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h2 class="text-xl font-semibold text-neutral-800">Logs</h2>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="flex items-center justify-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    }

    <!-- Logs Table -->
    @if (!isLoading() && logs().length > 0) {
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-neutral-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                Timestamp
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                Niveau
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                Logger
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                Message
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-neutral-200">
            @for (log of paginatedLogs(); track log.timestamp + log.message) {
              <tr class="hover:bg-neutral-50 transition-colors">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">
                  {{ formatTimestamp(log.timestamp) }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span [class]="getLevelClass(log.level)" class="px-2 py-1 text-xs font-semibold rounded border">
                    {{ log.level }}
                  </span>
                </td>
                <td class="px-6 py-4 text-sm text-neutral-600 max-w-xs truncate" [title]="log.logger">
                  {{ log.logger }}
                </td>
                <td class="px-6 py-4 text-sm text-neutral-900">
                  <div class="max-w-2xl">
                    {{ log.message }}
                    @if (log.exception) {
                      <details class="mt-2">
                        <summary class="cursor-pointer text-red-600 hover:text-red-700">
                          Voir l'exception
                        </summary>
                        <pre class="mt-2 p-2 bg-red-50 text-xs text-red-800 rounded overflow-x-auto">{{ log.exception }}</pre>
                      </details>
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    <!-- Pagination -->
    @if (!isLoading() && logs().length > 0) {
      <div class="px-6 py-4 bg-neutral-50 border-t border-neutral-200">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
          <!-- Page Size Selector -->
          <div class="flex items-center gap-2">
            <label class="text-sm text-neutral-700">Afficher:</label>
            <select
              [value]="pageSize()"
              (change)="changePageSize(+$any($event.target).value)"
              class="px-3 py-1 border border-neutral-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
              <option [value]="10">10</option>
              <option [value]="25">25</option>
              <option [value]="50">50</option>
              <option [value]="100">100</option>
            </select>
            <span class="text-sm text-neutral-700">
              par page
            </span>
          </div>

          <!-- Pagination Info -->
          <div class="text-sm text-neutral-700">
            Affichage {{ (currentPage() - 1) * pageSize() + 1 }} -
            {{ Math.min(currentPage() * pageSize(), filteredLogsCount()) }}
            sur {{ filteredLogsCount() }} logs
          </div>

          <!-- Page Navigation -->
          <div class="flex items-center gap-1">
            <!-- First Page -->
            <button
              (click)="goToPage(1)"
              [disabled]="currentPage() === 1"
              [class.opacity-50]="currentPage() === 1"
              [class.cursor-not-allowed]="currentPage() === 1"
              class="px-3 py-1 border border-neutral-300 rounded-lg text-sm hover:bg-neutral-100 transition-colors disabled:hover:bg-white">
              Â«Â«
            </button>

            <!-- Previous Page -->
            <button
              (click)="previousPage()"
              [disabled]="currentPage() === 1"
              [class.opacity-50]="currentPage() === 1"
              [class.cursor-not-allowed]="currentPage() === 1"
              class="px-3 py-1 border border-neutral-300 rounded-lg text-sm hover:bg-neutral-100 transition-colors disabled:hover:bg-white">
              Â«
            </button>

            <!-- Page Numbers -->
            @for (page of getPageNumbers(); track page) {
              @if (page === -1) {
                <span class="px-2 text-neutral-500">...</span>
              } @else {
                <button
                  (click)="goToPage(page)"
                  [class.bg-blue-600]="currentPage() === page"
                  [class.text-white]="currentPage() === page"
                  [class.border-blue-600]="currentPage() === page"
                  class="px-3 py-1 border border-neutral-300 rounded-lg text-sm hover:bg-neutral-100 transition-colors">
                  {{ page }}
                </button>
              }
            }

            <!-- Next Page -->
            <button
              (click)="nextPage()"
              [disabled]="currentPage() === totalPages()"
              [class.opacity-50]="currentPage() === totalPages()"
              [class.cursor-not-allowed]="currentPage() === totalPages()"
              class="px-3 py-1 border border-neutral-300 rounded-lg text-sm hover:bg-neutral-100 transition-colors disabled:hover:bg-white">
              Â»
            </button>

            <!-- Last Page -->
            <button
              (click)="goToPage(totalPages())"
              [disabled]="currentPage() === totalPages()"
              [class.opacity-50]="currentPage() === totalPages()"
              [class.cursor-not-allowed]="currentPage() === totalPages()"
              class="px-3 py-1 border border-neutral-300 rounded-lg text-sm hover:bg-neutral-100 transition-colors disabled:hover:bg-white">
              Â»Â»
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading() && logs().length === 0) {
      <div class="flex flex-col items-center justify-center py-12 text-neutral-500">
        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <p class="text-lg font-medium">Aucun log trouvÃ©</p>
        <p class="text-sm">Essayez de modifier vos filtres ou attendez que de nouveaux logs soient gÃ©nÃ©rÃ©s</p>
      </div>
    }
  </div>
</div>
