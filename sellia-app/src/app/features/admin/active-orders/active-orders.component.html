
    <div class="space-y-6">
      <!-- Header -->
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold text-white mb-2">Commandes en Temps R√©el</h1>
          <p class="text-neutral-400">Suivi de toutes les commandes actives</p>
        </div>
        <button (click)="refreshOrders()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-colors">
          üîÑ Rafra√Æchir
        </button>
      </div>

      <!-- Filter Tabs -->
      <div class="flex gap-4 border-b border-neutral-700 overflow-x-auto">
        <button 
          *ngFor="let status of orderStatuses"
          (click)="setFilter(status.value)"
          [class.border-b-2]="filter() === status.value"
          [class.border-orange-500]="filter() === status.value"
          [class.text-white]="filter() === status.value"
          [class.text-neutral-400]="filter() !== status.value"
          class="pb-2 font-semibold transition-colors whitespace-nowrap">
          {{ status.label }} ({{ getStatusCount(status.value) }})
        </button>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">En attente</p>
              <p class="text-3xl font-bold text-yellow-500">{{ getStatusCount('EN_ATTENTE') }}</p>
            </div>
            <div class="text-4xl opacity-30">‚è≥</div>
          </div>
        </div>

        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">En pr√©paration</p>
              <p class="text-3xl font-bold text-blue-500">{{ getStatusCount('EN_PREPARATION') }}</p>
            </div>
            <div class="text-4xl opacity-30">üë®‚Äçüç≥</div>
          </div>
        </div>

        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">Pr√™tes</p>
              <p class="text-3xl font-bold text-green-500">{{ getStatusCount('PRETE') }}</p>
            </div>
            <div class="text-4xl opacity-30">‚úÖ</div>
          </div>
        </div>

        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">Livr√©es</p>
              <p class="text-3xl font-bold text-purple-500">{{ getStatusCount('LIVREE') }}</p>
            </div>
            <div class="text-4xl opacity-30">üöö</div>
          </div>
        </div>

        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">CA en attente</p>
              <p class="text-2xl font-bold text-orange-400">{{ formatCurrency(totalAmount()) }}</p>
            </div>
            <div class="text-4xl opacity-30">‚è±Ô∏è</div>
          </div>
        </div>

        <div class="bg-neutral-800 rounded-lg p-6 border border-neutral-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-neutral-400 text-sm">CA encaiss√©</p>
              <p class="text-2xl font-bold text-green-400">{{ formatCurrency(paidAmount()) }}</p>
            </div>
            <div class="text-4xl opacity-30">üí∞</div>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="isLoading()" class="flex justify-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"></div>
      </div>

      <!-- Orders Table -->
      <div *ngIf="!isLoading() && filteredOrders().length > 0" class="bg-neutral-800 rounded-lg border border-neutral-700 overflow-hidden">
        <table class="w-full text-sm">
          <thead class="bg-neutral-700 border-b border-neutral-600">
            <tr>
              <th class="px-4 py-3 text-left font-semibold text-white">N¬∞ Cmd</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Table</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Articles</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Statut</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Par</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Montant</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Depuis</th>
              <th class="px-4 py-3 text-left font-semibold text-white">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders()" class="border-b border-neutral-700 hover:bg-neutral-700/50 transition-colors">
              <!-- N¬∞ Cmd -->
              <td class="px-4 py-4 font-bold text-orange-400">
                #{{ order.orderNumber }}
              </td>

              <!-- Table -->
              <td class="px-4 py-4 text-white">
                <div *ngIf="order.tableNumber">Table {{ order.tableNumber }}</div>
                <div *ngIf="!order.tableNumber" class="text-neutral-500">√Ä emporter</div>
              </td>

              <!-- Articles -->
              <td class="px-4 py-4">
                <div class="text-neutral-300">
                  <div *ngFor="let item of getOrderItems(order) | slice:0:2" class="text-xs">
                    {{ item.quantity }}x {{ item.productName }}
                  </div>
                  <div *ngIf="getOrderItems(order).length > 2" class="text-xs text-neutral-500">
                    +{{ getOrderItems(order).length - 2 }} article(s)
                  </div>
                </div>
              </td>

              <!-- Statut -->
              <td class="px-4 py-4">
                <span [class]="getOrderStatusClass(order.status)" class="px-2 py-1 rounded text-xs font-semibold">
                  {{ getOrderStatusLabel(order.status) }}
                </span>
              </td>

              <!-- Caissier / Client -->
              <td class="px-4 py-4 text-sm">
                <span *ngIf="order.cashierSessionCashierName || order.createdByUserName" class="text-neutral-300">
                  {{ order.cashierSessionCashierName || order.createdByUserName }}
                </span>
                <span *ngIf="!order.cashierSessionCashierName && !order.createdByUserName" class="text-blue-400">
                  <span *ngIf="order.customerName">üì± {{ order.customerName }}</span>
                  <span *ngIf="!order.customerName">üì± Client QR</span>
                </span>
              </td>

              <!-- Montant -->
              <td class="px-4 py-4 font-semibold text-green-400">
                {{ formatCurrency(order.totalAmount) }}
              </td>

              <!-- Depuis -->
              <td class="px-4 py-4 text-xs text-neutral-500">
                {{ getTimeDifference(order.createdAt) }}
              </td>

              <!-- Actions -->
              <td class="px-4 py-4">
                <button
                  (click)="openOrderDetails(order)"
                  class="text-blue-400 hover:text-blue-300 font-medium text-xs">
                  üëÅÔ∏è D√©tails
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading() && filteredOrders().length === 0" class="text-center py-12 bg-neutral-800 rounded-lg border border-neutral-700">
        <p class="text-neutral-400 text-lg">Aucune commande {{ getCurrentStatusLabel() }}</p>
      </div>

      <!-- Error Toast -->
      <div *ngIf="error()" class="fixed bottom-4 right-4 bg-red-600 text-white px-4 py-3 rounded-lg">
        {{ error() }}
      </div>

      <!-- Order Details Modal -->
      <div *ngIf="showModal()" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-neutral-800 rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-neutral-700">
          <!-- Modal Header -->
          <div class="sticky top-0 bg-neutral-800 border-b border-neutral-700 px-6 py-4 flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold text-white">Commande #{{ selectedOrder()?.orderNumber }}</h2>
              <p class="text-sm text-neutral-400 mt-1">{{ selectedOrder()?.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <button
              (click)="closeModal()"
              class="text-neutral-400 hover:text-white text-2xl leading-none">
              ‚úï
            </button>
          </div>

          <!-- Modal Body -->
          <div class="p-6 space-y-6">
            <!-- Status Badge -->
            <div class="flex items-center gap-4">
              <span [class]="getOrderStatusClass(selectedOrder()?.status)" class="px-3 py-1.5 rounded-lg text-sm font-semibold">
                {{ getOrderStatusLabel(selectedOrder()?.status) }}
              </span>
              <span *ngIf="selectedOrder()?.isPaid" class="px-3 py-1.5 rounded-lg text-sm font-semibold bg-green-900/30 text-green-300">
                ‚úì Pay√©e
              </span>
            </div>

            <!-- Order Info Grid -->
            <div class="grid grid-cols-2 gap-4">
              <!-- Table -->
              <div class="bg-neutral-700/50 rounded-lg p-4">
                <p class="text-xs text-neutral-400 mb-1">Table</p>
                <p class="text-white font-semibold">
                  <span *ngIf="selectedOrder()?.tableNumber">Table {{ selectedOrder()?.tableNumber }}</span>
                  <span *ngIf="!selectedOrder()?.tableNumber" class="text-neutral-500">√Ä emporter</span>
                </p>
              </div>

              <!-- Par -->
              <div class="bg-neutral-700/50 rounded-lg p-4">
                <p class="text-xs text-neutral-400 mb-1">Cr√©√© par</p>
                <p class="text-white font-semibold">
                  <span *ngIf="selectedOrder()?.cashierSessionCashierName || selectedOrder()?.createdByUserName">
                    {{ selectedOrder()?.cashierSessionCashierName || selectedOrder()?.createdByUserName }}
                  </span>
                  <span *ngIf="!selectedOrder()?.cashierSessionCashierName && !selectedOrder()?.createdByUserName" class="text-blue-400">
                    <span *ngIf="selectedOrder()?.customerName">üì± {{ selectedOrder()?.customerName }}</span>
                    <span *ngIf="!selectedOrder()?.customerName">üì± Client QR</span>
                  </span>
                </p>
              </div>

              <!-- Customer Name (if takeaway) -->
              <div *ngIf="selectedOrder()?.customerName && selectedOrder()?.orderType === 'TAKEAWAY'" class="bg-neutral-700/50 rounded-lg p-4">
                <p class="text-xs text-neutral-400 mb-1">Client</p>
                <p class="text-white font-semibold">{{ selectedOrder()?.customerName }}</p>
                <p *ngIf="selectedOrder()?.customerPhone" class="text-sm text-neutral-400 mt-1">{{ selectedOrder()?.customerPhone }}</p>
              </div>

              <!-- Payment Method -->
              <div *ngIf="selectedOrder()?.paymentMethod" class="bg-neutral-700/50 rounded-lg p-4">
                <p class="text-xs text-neutral-400 mb-1">Mode de paiement</p>
                <p class="text-white font-semibold">{{ selectedOrder()?.paymentMethod }}</p>
              </div>
            </div>

            <!-- Notes -->
            <div *ngIf="selectedOrder()?.notes" class="bg-neutral-700/50 rounded-lg p-4">
              <p class="text-xs text-neutral-400 mb-1">üìù Notes</p>
              <p class="text-white">{{ selectedOrder()?.notes }}</p>
            </div>

            <!-- Items List -->
            <div>
              <h3 class="text-lg font-bold text-white mb-3">Articles command√©s</h3>
              <div class="bg-neutral-700/50 rounded-lg overflow-hidden">
                <div *ngFor="let item of getOrderItems(selectedOrder()); let last = last"
                     [class.border-b]="!last"
                     class="border-neutral-600 p-4">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="bg-orange-500 text-white px-2 py-0.5 rounded text-xs font-bold">
                          {{ item.quantity }}x
                        </span>
                        <span class="text-white font-semibold">{{ item.product?.name || 'Produit' }}</span>
                      </div>
                      <p *ngIf="item.notes" class="text-sm text-neutral-400 mt-1 ml-10">
                        üí¨ {{ item.notes }}
                      </p>
                      <!-- Menu items -->
                      <div *ngIf="item.menuItem?.products && item.menuItem.products.length > 0" class="ml-10 mt-2 space-y-1">
                        <p class="text-xs text-neutral-500 font-semibold">Menu: {{ item.menuItem.menuName }}</p>
                        <div *ngFor="let product of item.menuItem.products" class="text-xs text-neutral-400">
                          ‚Ä¢ {{ product.name }}
                        </div>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="text-green-400 font-bold">{{ formatCurrency(item.totalPrice) }}</p>
                      <p *ngIf="item.quantity > 1" class="text-xs text-neutral-500">{{ formatCurrency(item.unitPrice) }} / unit√©</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Section -->
            <div class="bg-neutral-700 rounded-lg p-4 space-y-2">
              <div class="flex justify-between text-neutral-300">
                <span>Sous-total:</span>
                <span>{{ formatCurrency(selectedOrder()?.totalAmount) }}</span>
              </div>
              <div *ngIf="selectedOrder()?.discountAmount && selectedOrder()?.discountAmount > 0" class="flex justify-between text-red-400">
                <span>Remise:</span>
                <span>-{{ formatCurrency(selectedOrder()?.discountAmount) }}</span>
              </div>
              <div class="border-t border-neutral-600 pt-2 flex justify-between text-white font-bold text-lg">
                <span>TOTAL:</span>
                <span class="text-green-400">{{ formatCurrency(selectedOrder()?.finalAmount || selectedOrder()?.totalAmount) }}</span>
              </div>
            </div>

            <!-- Timestamps -->
            <div class="grid grid-cols-2 gap-4 text-xs">
              <div class="bg-neutral-700/50 rounded-lg p-3">
                <p class="text-neutral-400 mb-1">Cr√©√©e</p>
                <p class="text-white">{{ selectedOrder()?.createdAt | date:'dd/MM/yyyy HH:mm:ss' }}</p>
              </div>
              <div *ngIf="selectedOrder()?.paidAt" class="bg-neutral-700/50 rounded-lg p-3">
                <p class="text-neutral-400 mb-1">Pay√©e</p>
                <p class="text-white">{{ selectedOrder()?.paidAt | date:'dd/MM/yyyy HH:mm:ss' }}</p>
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="sticky bottom-0 bg-neutral-800 border-t border-neutral-700 px-6 py-4">
            <button
              (click)="closeModal()"
              class="w-full px-4 py-2 bg-neutral-700 hover:bg-neutral-600 text-white rounded-lg font-semibold transition-colors">
              Fermer
            </button>
          </div>
        </div>
      </div>
    </div>
