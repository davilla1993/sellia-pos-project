<div class="min-h-screen bg-gradient-to-br from-neutral-900 to-neutral-800 p-6 pt-24">

    <!-- Header avec Logo -->
    <div class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-4">
        <img [src]="restaurantService.restaurantInfo().logoUrl"
             [alt]="restaurantService.restaurantInfo().name"
             class="w-16 h-16 rounded-lg object-cover shadow-lg">
        <div>
          <h1 class="text-3xl font-bold text-white">üìä Rapports</h1>
          <p class="text-neutral-400">{{ restaurantService.restaurantInfo().name }}</p>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="flex gap-2 mb-6 bg-neutral-800 p-2 rounded-lg border border-neutral-700">
      <button
        (click)="navigateToTab('sales')"
        [class.bg-primary]="currentReportType() === 'sales'"
        [class.text-white]="currentReportType() === 'sales'"
        [class.text-neutral-400]="currentReportType() !== 'sales'"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all hover:bg-primary/80 hover:text-white">
        üí∞ Ventes
      </button>
      <button
        (click)="navigateToTab('cashiers')"
        [class.bg-primary]="currentReportType() === 'cashiers'"
        [class.text-white]="currentReportType() === 'cashiers'"
        [class.text-neutral-400]="currentReportType() !== 'cashiers'"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all hover:bg-primary/80 hover:text-white">
        üí≥ Caisses
      </button>
      <button
        (click)="navigateToTab('staff')"
        [class.bg-primary]="currentReportType() === 'staff'"
        [class.text-white]="currentReportType() === 'staff'"
        [class.text-neutral-400]="currentReportType() !== 'staff'"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all hover:bg-primary/80 hover:text-white">
        üë• Personnel
      </button>
      <button
        (click)="navigateToTab('products')"
        [class.bg-primary]="currentReportType() === 'products'"
        [class.text-white]="currentReportType() === 'products'"
        [class.text-neutral-400]="currentReportType() !== 'products'"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all hover:bg-primary/80 hover:text-white">
        üçΩÔ∏è Produits
      </button>
      <button
        (click)="navigateToTab('sessions')"
        [class.bg-primary]="currentReportType() === 'sessions'"
        [class.text-white]="currentReportType() === 'sessions'"
        [class.text-neutral-400]="currentReportType() !== 'sessions'"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all hover:bg-primary/80 hover:text-white">
        üìã Sessions
      </button>
      <button
        (click)="navigateToSearch()"
        class="flex-1 px-4 py-3 rounded-lg font-semibold transition-all bg-neutral-700 text-white hover:bg-primary/80">
        üîç Recherche Facture
      </button>
    </div>

    <!-- Filters Panel -->
    <div *ngIf="currentReportType() !== 'sessions'" class="bg-neutral-800 rounded-lg border border-neutral-700 p-6 mb-6">
      <h3 class="text-lg font-bold text-white mb-4">üîç Filtres</h3>

      <form [formGroup]="filterForm" (ngSubmit)="applyFilter()">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">

          <!-- Sales: Global Session Selector -->
          <div *ngIf="currentReportType() === 'sales'" class="md:col-span-2 lg:col-span-3">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">Session Globale</label>
            <select formControlName="globalSessionId"
                    class="w-full bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
              <option value="">-- S√©lectionner une session --</option>
              <option *ngFor="let session of globalSessions()" [value]="session.publicId">
                Session du {{ formatDate(session.openedAt) }} - {{ session.status }}
              </option>
            </select>
          </div>

          <!-- Cashiers: Cashier Selector -->
          <div *ngIf="currentReportType() === 'cashiers'">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">Caisse</label>
            <select formControlName="cashierId"
                    class="w-full bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
              <option value="">-- S√©lectionner une caisse --</option>
              <option *ngFor="let cashier of cashiers()" [value]="cashier.publicId">
                {{ cashier.name }} ({{ cashier.cashierNumber }})
              </option>
            </select>
          </div>

          <!-- Staff: User Selector -->
          <div *ngIf="currentReportType() === 'staff'">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">Utilisateur</label>
            <select formControlName="userId"
                    class="w-full bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
              <option value="">-- S√©lectionner un utilisateur --</option>
              <option *ngFor="let user of users()" [value]="user.publicId">
                {{ user.firstName }} {{ user.lastName }} ({{ user.role }})
              </option>
            </select>
          </div>

          <!-- Date Range (for Cashiers, Staff, Products) -->
          <div *ngIf="currentReportType() !== 'sales'">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">Date D√©but</label>
            <input type="date" formControlName="startDate"
                   class="w-full bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>

          <div *ngIf="currentReportType() !== 'sales'">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">Date Fin</label>
            <input type="date" formControlName="endDate"
                   class="w-full bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
        </div>

        <button type="submit"
                [disabled]="!filterForm.valid || loading()"
                class="w-full md:w-auto px-6 py-3 bg-primary hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors">
          {{ loading() ? '‚è≥ Chargement...' : 'üìä Afficher le Rapport' }}
        </button>
      </form>
    </div>

    <!-- Error Message -->
    <div *ngIf="error()" class="bg-red-500/10 border border-red-500 text-red-400 rounded-lg p-4 mb-6">
      {{ error() }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading()" class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
    </div>

    <!-- Report Display -->
    <div *ngIf="reportData() && !loading()" class="space-y-6">

      <!-- Download PDF Button -->
      <div class="flex justify-end">
        <button (click)="downloadPdf()"
                class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition-colors flex items-center gap-2">
          üì• T√©l√©charger PDF
        </button>
      </div>

      <!-- Sales Report (Global Session) -->
      <div *ngIf="currentReportType() === 'sales'" class="space-y-6">
        <div class="bg-neutral-800 rounded-lg border border-neutral-700 p-6">
          <h2 class="text-2xl font-bold text-white mb-6">üí∞ Rapport de Ventes - Session Globale</h2>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-4">
              <p class="text-blue-300 text-sm font-semibold mb-1">Total Ventes</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalSales) }}</p>
            </div>
            <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-4">
              <p class="text-green-300 text-sm font-semibold mb-1">Commandes</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalOrders }}</p>
            </div>
            <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-lg p-4">
              <p class="text-yellow-300 text-sm font-semibold mb-1">Remises</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalDiscounts) }}</p>
            </div>
            <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-lg p-4">
              <p class="text-purple-300 text-sm font-semibold mb-1">Montant Final</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().finalAmount) }}</p>
            </div>
          </div>

          <!-- Cashier Sessions Table -->
          <div class="mb-6">
            <h3 class="text-xl font-bold text-white mb-4">Sessions Caisses</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Caisse</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Utilisateur</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Ventes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Commandes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Dur√©e</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let session of reportData().cashierSessions; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ session.cashierName }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-300">{{ session.userName }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(session.totalSales) }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ session.orderCount }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-300">{{ calculateDuration(session.openedAt, session.closedAt) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Top Products Table -->
          <div>
            <h3 class="text-xl font-bold text-white mb-4">Top 10 Produits</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Produit</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Quantit√©</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Montant</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of reportData().topProducts; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ product.productName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ product.quantity }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(product.totalAmount) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Cashiers Report -->
      <div *ngIf="currentReportType() === 'cashiers'" class="space-y-6">
        <div class="bg-neutral-800 rounded-lg border border-neutral-700 p-6">
          <h2 class="text-2xl font-bold text-white mb-6">üí≥ Rapport de Caisse - {{ reportData().cashierName }}</h2>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-4">
              <p class="text-blue-300 text-sm font-semibold mb-1">Total Ventes</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalSales) }}</p>
            </div>
            <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-4">
              <p class="text-green-300 text-sm font-semibold mb-1">Commandes</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalOrders }}</p>
            </div>
            <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-lg p-4">
              <p class="text-purple-300 text-sm font-semibold mb-1">Moyenne</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().averageOrderValue) }}</p>
            </div>
            <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-lg p-4">
              <p class="text-yellow-300 text-sm font-semibold mb-1">Remises</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalDiscounts) }}</p>
            </div>
          </div>

          <!-- Users Table -->
          <div class="mb-6">
            <h3 class="text-xl font-bold text-white mb-4">Utilisateurs</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Utilisateur</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Commandes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Ventes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Moyenne</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let user of reportData().users; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ user.firstName }} {{ user.lastName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ user.orderCount }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(user.totalSales) }}</td>
                    <td class="px-4 py-3 text-sm text-purple-400 font-semibold">
                      {{ formatCurrency(user.orderCount > 0 ? user.totalSales / user.orderCount : 0) }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Top Products Table -->
          <div>
            <h3 class="text-xl font-bold text-white mb-4">Top 10 Produits</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Produit</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Quantit√©</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Montant</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of reportData().topProducts; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ product.productName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ product.quantity }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(product.totalAmount) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Staff Report -->
      <div *ngIf="currentReportType() === 'staff'" class="space-y-6">
        <div class="bg-neutral-800 rounded-lg border border-neutral-700 p-6">
          <h2 class="text-2xl font-bold text-white mb-6">üë• Rapport Personnel - {{ reportData().firstName }} {{ reportData().lastName }}</h2>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-4">
              <p class="text-blue-300 text-sm font-semibold mb-1">Total Ventes</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalSales) }}</p>
            </div>
            <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-4">
              <p class="text-green-300 text-sm font-semibold mb-1">Commandes</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalOrders }}</p>
            </div>
            <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-lg p-4">
              <p class="text-purple-300 text-sm font-semibold mb-1">Moyenne</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().averageOrderValue) }}</p>
            </div>
            <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-lg p-4">
              <p class="text-yellow-300 text-sm font-semibold mb-1">Remises</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalDiscounts) }}</p>
            </div>
          </div>

          <!-- Cashiers Used Table -->
          <div class="mb-6">
            <h3 class="text-xl font-bold text-white mb-4">Caisses Utilis√©es</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Caisse</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Commandes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Ventes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let cashier of reportData().cashiers; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ cashier.cashierName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ cashier.orderCount }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(cashier.totalSales) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Top Products Table -->
          <div>
            <h3 class="text-xl font-bold text-white mb-4">Top 10 Produits</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Produit</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Quantit√©</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Montant</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of reportData().topProducts; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ product.productName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ product.quantity }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(product.totalAmount) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Sessions Report -->
      <div *ngIf="currentReportType() === 'sessions'" class="space-y-6">
        <div class="bg-neutral-800 rounded-lg border border-neutral-700 p-6">
          <h2 class="text-2xl font-bold text-white mb-6">üìã Rapports de Session de Caisse</h2>

          <!-- Session ID Input -->
          <div class="mb-6">
            <label class="block text-sm font-semibold text-neutral-300 mb-2">ID de Session</label>
            <div class="flex gap-2">
              <input
                type="text"
                [(ngModel)]="sessionIdInput"
                placeholder="Entrez l'ID de la session (ex: S-..."
                class="flex-1 bg-neutral-700 text-white rounded-lg p-3 border border-neutral-600 focus:outline-none focus:ring-2 focus:ring-primary">
              <button
                (click)="viewSessionReport()"
                [disabled]="!sessionIdInput"
                class="px-6 py-3 bg-primary hover:bg-primary/90 disabled:bg-neutral-600 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors">
                Afficher le Rapport
              </button>
            </div>
          </div>

          <!-- Recent Sessions List -->
          <div *ngIf="!selectedSessionId() && cashierSessions().length > 0">
            <h3 class="text-lg font-bold text-white mb-4">Sessions R√©centes</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">ID Session</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Caisse</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Caissier</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Ouverture</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Fermeture</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Statut</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let session of cashierSessions()"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-white font-mono">{{ session.publicId }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-300">{{ session.cashierName || 'N/A' }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-300">{{ session.userName || 'N/A' }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ formatDateTime(session.openedAt) }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ session.closedAt ? formatDateTime(session.closedAt) : '-' }}</td>
                    <td class="px-4 py-3 text-sm">
                      <span *ngIf="session.status === 'OPEN'" class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs">Ouverte</span>
                      <span *ngIf="session.status === 'LOCKED'" class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs">Verrouill√©e</span>
                      <span *ngIf="session.status === 'CLOSED'" class="px-2 py-1 bg-neutral-500/20 text-neutral-400 rounded text-xs">Ferm√©e</span>
                    </td>
                    <td class="px-4 py-3 text-sm">
                      <button
                        *ngIf="session.status === 'CLOSED'"
                        (click)="selectSessionFromList(session.publicId)"
                        class="px-3 py-1 bg-primary hover:bg-primary/90 text-white rounded text-xs transition-colors">
                        Voir Rapport
                      </button>
                      <span *ngIf="session.status !== 'CLOSED'" class="text-neutral-500 text-xs">-</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Session Report Display -->
          <div *ngIf="selectedSessionId()">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold text-white">Rapport de Session: {{ selectedSessionId() }}</h3>
              <button
                (click)="clearSessionReport()"
                class="px-4 py-2 bg-neutral-700 hover:bg-neutral-600 text-white rounded-lg font-semibold transition-colors">
                ‚Üê Retour
              </button>
            </div>
            <app-session-report
              [sessionId]="selectedSessionId()!"
              [autoLoad]="true">
            </app-session-report>
          </div>
        </div>
      </div>

      <!-- Products Report -->
      <div *ngIf="currentReportType() === 'products'" class="space-y-6">
        <div class="bg-neutral-800 rounded-lg border border-neutral-700 p-6">
          <h2 class="text-2xl font-bold text-white mb-6">üçΩÔ∏è Rapport Produits</h2>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-4">
              <p class="text-blue-300 text-sm font-semibold mb-1">Chiffre d'affaires</p>
              <p class="text-2xl font-bold text-white">{{ formatCurrency(reportData().totalRevenue) }}</p>
            </div>
            <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-4">
              <p class="text-green-300 text-sm font-semibold mb-1">Quantit√© vendue</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalQuantitySold }}</p>
            </div>
            <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-lg p-4">
              <p class="text-purple-300 text-sm font-semibold mb-1">Commandes</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalOrders }}</p>
            </div>
            <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-lg p-4">
              <p class="text-yellow-300 text-sm font-semibold mb-1">Produits</p>
              <p class="text-2xl font-bold text-white">{{ reportData().totalProducts }}</p>
            </div>
          </div>

          <!-- Products Table -->
          <div>
            <h3 class="text-xl font-bold text-white mb-4">D√©tails par Produit</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-neutral-700">
                  <tr>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">#</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Produit</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Cat√©gorie</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Quantit√©</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Chiffre d'affaires</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Commandes</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Prix moyen</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-300">Statut</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of reportData().products; let i = index"
                      class="border-t border-neutral-700 hover:bg-neutral-700/50">
                    <td class="px-4 py-3 text-sm text-neutral-400">{{ i + 1 }}</td>
                    <td class="px-4 py-3 text-sm text-white">{{ product.productName }}</td>
                    <td class="px-4 py-3 text-sm text-neutral-300">{{ product.categoryName }}</td>
                    <td class="px-4 py-3 text-sm text-blue-400 font-semibold">{{ product.quantitySold }}</td>
                    <td class="px-4 py-3 text-sm text-green-400 font-semibold">{{ formatCurrency(product.totalRevenue) }}</td>
                    <td class="px-4 py-3 text-sm text-purple-400 font-semibold">{{ product.orderCount }}</td>
                    <td class="px-4 py-3 text-sm text-yellow-400 font-semibold">{{ formatCurrency(product.averagePrice) }}</td>
                    <td class="px-4 py-3 text-sm">
                      <span *ngIf="product.isAvailable" class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs">Disponible</span>
                      <span *ngIf="!product.isAvailable" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs">Indisponible</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
